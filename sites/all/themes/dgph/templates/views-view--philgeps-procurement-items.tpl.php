<?php/** * @file * Template to display the procurement items view. * Contextual Filters: *  - agency identifier (default: 137 - Departement of Agriculture) *  - year posted (default: 2013) *  - bid classification *  - approved budget *  - procurement mode *  - bid status * @ingroup views_templates */?><?php    $vars = get_defined_vars();    $agencyId = arg(2) ? arg(2) : '';    $region = arg(9) ? arg(9) : 'all';    $year = arg(3) ? arg(3) : (int) date('Y');    $agencyNode = node_load($agencyId);    $agencyName = $agencyNode->title ? $agencyNode->title : 'Most Recent Procurements';    $agencies = dgph_philgeps_api_get_agencies();    $view = $vars['view'];    $rows = $view->result;    /*$map = openlayers_map_load('philgeps_kml_viewer');*/    /*$mapCode = openlayers_render_map($map->data,$map->name);*/    global $user;    $roles = $user->roles;?><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.4.1/chosen.min.css"><style type="text/css">    .twitter-typeahead {        width: 100%;        text-transform: uppercase;    }    #org_biglist {        text-transform: uppercase;        margin: 0;    }    .tt-dropdown-menu {        background-color: #FFFFFF;        border: solid 1px #CECECE;        border-top: none;        margin-top: 0;        width: 100%;        max-height: 300px;        overflow-y: scroll;    }    .tt-suggestion {        margin: 0!important;        padding: 0 10px;    }    .tt-suggestion.tt-cursor {        color: #fff;        background-color: #0097cf;    }    .filter_description_text {        font-size: 14px;          color: #414141;          margin: 15px 0 0;          padding: 0;          font-family: 'Roboto' !important;          font-weight: normal;          line-height: 19px;    }    form div#region-select-form-wrapper div.chosen-container-single {        width: 100%;    }    form div#region-select-form-wrapper a.chosen-single {         color: inherit;          display: inherit;          font-family: inherit;          font-weight: inherit;          font-family: inherit;          font-size: inherit;          padding: 0 0 0 10px;          text-decoration: inherit;          text-transform: inherit;          width: inherit;     }        .page-infographics .agency p, .filter_description_text {	    font-size: 14px!important;	    line-height: 150%!important;    }        .page-infographics .works h2 {	    margin: 0px 0 15px!important;	    width: 80%!important;    }        .page-infographics .year-con #accordion h3 .title-line {	    font-size: 20px!important;		font-weight: 700!important;		color: #000!important;		border-bottom: 2px solid #000!important;    }        .twitter-typeahead {	    font-size: 20px!important;		box-shadow: none!important;		border: none!important; 		border-top: none!important;		border-left: none!important;		border-right: none!important;		border-bottom: 1px solid #000!important;		padding-left: 0px!important;		padding-bottom: 0px!important;		height: 100%!important;		border-bottom-width: 1px!important;		font-weight: bold;    }        ::-webkit-input-placeholder {		color: black;	}		:-moz-placeholder { /* Firefox 18- */	   color: black;  	}		.arrow-down-select {	   position: absolute;	   right: 0;	   margin-top: -31px;	}		.select-help {		padding: 10px 10px 10px 10px;		color: #7e7e7e;		font-size: 14px;		background-color: #f1f1f1;		background-image:  url("images/info-icon-bg.png") no-repeat top left!important;		border: 2px dashed #bababa;		border-radius: 3px;		margin-top: 20px;	}	/*	.page-infographics div.legend {		margin-bottom: 10px!important;	}*/		.mb50 {		margin-bottom: 50px!important;	}</style><input type="hidden" id="current_org_id" value="<?php echo $agencyId ?>" /><input type="hidden" id="current_region" value="<?php echo $region ?>" /><script type="text/javascript">(function(funcName, baseObj) {    // The public function name defaults to window.docReady    // but you can pass in your own object and own function name and those will be used    // if you want to put them in a different namespace    funcName = funcName || "docReady";    baseObj = baseObj || window;    var readyList = [];    var readyFired = false;    var readyEventHandlersInstalled = false;    // call this when the document is ready    // this function protects itself against being called more than once    function ready() {        if (!readyFired) {            // this must be set to true before we start calling callbacks            readyFired = true;            for (var i = 0; i < readyList.length; i++) {                // if a callback here happens to add new ready handlers,                // the docReady() function will see that it already fired                // and will schedule the callback to run right after                // this event loop finishes so all handlers will still execute                // in order and no new ones will be added to the readyList                // while we are processing the list                readyList[i].fn.call(window, readyList[i].ctx);            }            // allow any closures held by these functions to free            readyList = [];        }    }    function readyStateChange() {        if ( document.readyState === "complete" ) {            ready();        }    }    // This is the one public interface    // docReady(fn, context);    // the context argument is optional - if present, it will be passed    // as an argument to the callback    baseObj[funcName] = function(callback, context) {        // if ready has already fired, then just schedule the callback        // to fire asynchronously, but right away        if (readyFired) {            setTimeout(function() {callback(context);}, 1);            return;        } else {            // add the function and context to the list            readyList.push({fn: callback, ctx: context});        }        // if document already ready to go, schedule the ready function to run        if (document.readyState === "complete") {            setTimeout(ready, 1);        } else if (!readyEventHandlersInstalled) {            // otherwise if we don't have event handlers installed, install them            if (document.addEventListener) {                // first choice is DOMContentLoaded event                document.addEventListener("DOMContentLoaded", ready, false);                // backup is window load event                window.addEventListener("load", ready, false);            } else {                // must be IE                document.attachEvent("onreadystatechange", readyStateChange);                window.attachEvent("onload", ready);            }            readyEventHandlersInstalled = true;        }    }})("docReady", window);</script><div class='row dashboard-header'>    <div class='large-6 columns agency'>        <h2 class='title'>Infographics</h2>        <h3 class='title'>PROCUREMENT NOTICES AND AWARDS</h3>        <p>The Procurement Notices and Details contain information on the procurement activities of an agency which is hosted in website, the single portal that serves as the primary and definitive source of information on procurement, only displays information provided for by the agencies and is not responsible for any typographical errors or misinformation presented.</p>        <p>To learn more about the Procurement Process, and understand the relation between budgeting and the procurement process, <a href="#" target="_blank">click here</a>. This information is also made publicly available via an <a href="#" target="_blank">Procurement API (Click here)</a>.</p>    </div>    <div class='large-6 columns'>        <div class='year-con' style="overflow: visible;">            <div class='year'><a href='#' data-dropdown='#philgeps-select-year'><span><?php echo $year ?></span></a></div>            <div id='accordion' class='procurement-accordion' data-dropdown='#philgeps-select-agency' data-vertical-offset='-25'>                <h3><div class='title-line'>Filter by National Agency</div></h3>                <br />            </div>            <span id='philgeps-selected-year' style='display:none'><?php echo $year ?></span>            <span id='philgeps-selected-agency-id' style='display:none'><?php echo $agencyId ?></span>            <div id='philgeps-select-year' class='dropdown dropdown-tip dropdown-relative'>                <ul class='dropdown-menu'><?php        $thisYear = date('Y');        for($selYear = $thisYear; $selYear>=2010; $selYear--) {?>                    <li><a href='javascript:void(0)' class='philgeps-year-ref'><?php echo $selYear ?></a></li><?php   } ?>                </ul>            </div>            <div id='philgeps-select-agency' class='dropdown dropdown-tip dropdown-relative'>                <ul class='dropdown-menu' style="max-width: 450px;">                                        <li><a>Department 1</a></li>                    <li><a>Department 2</a></li>                    <li><a>Department 3</a></li>                    <li><a>Department 4</a></li>                    <li><a>Department 5</a></li>                    <li><a>Department 6</a></li>                    <li><a>Department 7</a></li>                    <li><a>Department 8</a></li>                    <li><a>Department 9</a></li>                    <li><a>Department 10</a></li>                    <li><a>Department 11</a></li>                    <li><a>Department 12</a></li>                    <li><a>Department 13</a></li>                                    </ul>            </div>            <div><!--                 <h3 style="font-size: 20px; text-transform: uppercase;">Select a Procuring Entity</h3> -->                <div>                	                    <input id="org_biglist" class="twitter-typeahead" type="text" placeholder="Filter by Procuring Entity" disabled="disabled" />					<img src="/wb-dgph/sites/all/themes/dgph/css/images/arrow-down.png" title="Select a Procuring Entity" class="arrow-down-select"/>                </div>                <div class="filter_description_text">                    <!--<p>                        Filter the available results by using the above dropdown selections: Year - Select the year of results you'd like to view. Select an Agency - Select the primary government agency you'd like to view or use Select a Procuring Entity to focus on a single agency or department.</p>                        -->						<p style="font-size: 13px;">Examples: <em>"Development Authority"</em></p>						<p>With <span id="total_data_rows"></span> rows of data on procurement records open, we have created a set of filters which will allow you to easily search across all records. For example you can search by Year, Procuring Entity, Procurement Mode, Procurement Amount and Location.                        For further information and a comprehensive user guide to this dashboard, <a href="#">click here</a>.</p>                </div>            </div>        </div>    </div></div><div class='row'>    <div class='large-3 columns rightside datarequest choosePillar'>        <div class='search-con'>            <h3 class='left-ui-accordion-header'>Search By</h3>            <div class='search-area'>                <input id='lookup-philgeps' type='image' class='clander-btn' src= '/wb-dgph/sites/all/modules/dgph_infographics/images/search-icon.png' name=''> <input id='philgeps_free_search' type='text' class='clander-search' name=''>            </div>            <div id='lookup-category' class='bid-con'>                <span class='bidnum'><a href="#">Bid Number</a></span>                <span class='funding'><a href="#">Funding Source</a></span>                <span class='keyword'><a href="#">Keyword</a></span>                </div>        </div>        <div id='accordion-notices-search' class='procurement-accordion ui-accordion ui-widget ui-helper-reset' role='tablist'>            <h3 class='left-ui-accordion-header'>Bid Classification</h3>            <div>                <form class='custom'>                    <?php                        $curBc = arg(4) ? arg(4) : 'all';                        $bcs = philgeps_get_bid_classifications();                        foreach($bcs as $idx => $bc) {                            $optId = "philgeps_bc_".($idx+1);                            $checked = ($bc==$curBc) ? " checked='checked'" : "";                            $clsChecked = ($bc==$curBc) ? " checked" : "";                            echo "<label for='$optId' class='philgeps_bc'><input type='radio' style='display: none;' id='$optId' name='philgeps_bc' value='$bc'$checked><div class='philgeps-filter-label'>$bc</div></label>";                        }                    ?>                </form>            </div>             <h3 class='left-ui-accordion-header'>Approved Budget</h3>            <div>                <form class='custom'>                    <?php                        $curAb = arg(5) ? arg(5) : 'all';                        $abs = philgeps_get_approved_budget_ranges();                        foreach($abs as $idx => $ab) {                            $optId = "philgeps_ab_".($idx+1);                            $from = $ab['from'];                            $to = ($ab['to']!=-1) ? $ab['to'] : '';                            $label = "";                            if (!empty($to)) {                                $label = number_format($from)." - ".number_format($to);                            }                            else {                                $label = "Above ".number_format($from);                            }                            $abFilter = "$from--$to";                            $checked = ($abFilter==$curAb) ? " checked='checked'" : "";                            $clsChecked = ($abFilter==$curAb) ? " checked" : "";                            echo "<label for='$optId' class='philgeps_ab'><input type='radio' style='display: none;' id='$optId' name='philgeps_ab' value='$abFilter'$checked><div class='philgeps-label'>$label</div></label>";                        }                    ?>                </form>            </div>             <h3 class='left-ui-accordion-header'>Procurement Mode</h3>            <div>                <form class='custom'>                    <?php                        $curPm = arg(6) ? arg(6) : 'all';                        $pms = philgeps_get_procurement_modes();                        foreach($pms as $idx => $pm) {                            $optId = "philgeps_pm_".($idx+1);                            $checked = ($pm==$curPm) ? " checked='checked'" : "";                            $clsChecked = ($pm==$curPm) ? " checked" : "";                            $pmLabel = preg_replace('/\(sec\. (\d+)(\.(\d+))?(\.[AB])?\)/i', '', $pm);                            echo "<label for='$optId' class='philgeps_pm'><input type='radio' style='display: none;' id='$optId' name='philgeps_pm' value='$pm'$checked><div class='philgeps-filter-label'>$pmLabel</div></label>";                        }                    ?>                </form>            </div>             <h3 class='left-ui-accordion-header'>Status</h3>            <div>                <form class='custom'>                     <?php                        $curSt = arg(7) ? arg(7) : 'all';                        $sts = philgeps_get_statuses();                        foreach($sts as $idx => $st) {                            $optId = "philgeps_st_".($idx+1);                            $checked = ($st==$curSt) ? " checked='checked'" : "";                            $clsChecked = ($st==$curSt) ? " checked" : "";                            echo "<label for='$optId' class='philgeps_st'><input type='radio' style='display: none;' id='$optId' name='philgeps_st' value='$st'$checked><div class='philgeps-filter-label'>$st</div></label>";                        }                    ?>                </form>            </div>             <h3 class='left-ui-accordion-header'>Select a Month</h3>            <div>                <form class='custom'>                     <?php                        $curMid = arg(8) ? arg(8) : 'all';                        $months = array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December");                        foreach($months as $idx => $mn) {                            $mid = $idx + 1;                            $optId = "philgeps_mn_$mid";                            $checked = ($mid==$curMid) ? " checked='checked'" : "";                            $clsChecked = ($mid==$curMid) ? " checked" : "";                            echo "<label for='$optId' class='philgeps_mn'><input type='radio' style='display: none;' id='$optId' name='philgeps_mn' value='$mid'$checked><div class='philgeps-filter-label'>$mn</div></label>";                        }                    ?>                </form>            </div>             <h3 class='left-ui-accordion-header'>Location</h3>            <div>                <form>                     <div id="region-select-form-wrapper" style="height: 350px;">                        <select id="select-region-id" name="select-region">                            <option >Select Region</option>                            <option value='Region I'>I</option>                            <option value='II'>II</option>                            <option value='III'>III</option>                            <option value='IV-A'>IV-A</option>                            <option value='IV-B'>IV-B</option>                            <option value='V'>V</option>                            <option value='VI'>VI</option>                            <option value='VII'>VII</option>                            <option value='VIII'>VIII</option>                            <option value='IX'>IX</option>                            <option value='X'>X</option>                            <option value='XI'>XI</option>                            <option value='XII'>XII</option>                        </select>                        <p class="select-help">Select a region above to display all procurements for that region.</p>                    </div>                </form>            </div>         </div>        <div class="apply-filters-container">            <input id="apply-filters" class="form-submit philgeps-apply-filters" type="button" value="Apply" name="">            <input id="clear-filters" class="form-submit philgeps-clear-filters" type="button" value="Clear" name="">        </div>    </div>    <div class='large-9 columns works'>        <h2 id="agency_title"><?php echo $agencyName; ?></h2>        <ul class='social-icon'>           <li><a><img src='/wb-dgph/sites/all/themes/dgph/images/icon-11.png'></a></li>                                <li><a><img src='/wb-dgph/sites/all/themes/dgph/images/icon-19.png'></a></li>                                <li><a><img src='/wb-dgph/sites/all/themes/dgph/images/icon-20.png'></a></li>         </ul>        <div class='clear'></div>        <div class='public-works-con'>            <div class='cell-2'>Date Posted</div>            <div class='cell-3'>BID #</div>            <div class='cell-4'>Funding source</div>            <div class='cell-5'>B.C <a href='#' title='Bid Classification' class='has-tip'>info</a></div>            <div class='cell-6'>P.M <a href='#' title='Procurement Mode' class='has-tip'>info</a></div>            <div class='cell-7'>Approved Budget</div>            <div class='cell-8'>Contract Amount</div>            <div class='cell-15'>Bid Status</div>        </div>        <div class='clear'></div>        <div id='accordion-notices'>            <?php                foreach($rows as $row) {                    $nid = $row->nid;                    $bidNo = $row->field_field_bid_reference_number[0]['raw']['value'];                    $orgID = $row->field_field_orgid[0]['raw']['value'];                    $bidTitle = $row->node_title;                    $projectName = $row->node_title;                    $dt = strtotime($row->field_field_date_posted[0]['raw']['value']);                    $bc = $row->field_field_bid_classification[0]['raw']['value'];                    $pm = $row->field_field_procurement_mode[0]['raw']['value'];                    $status = strtolower($row->field_field_bid_status[0]['raw']['value']);                    $dtBid = ($status!='closed') ? $row->field_field_bid_status_date[0]['raw']['value'] : '';                    if (strpos($dtBid,' 1970') !== false) {                        $dtBid = '';                    }                    $source = $row->field_field_funding_source[0]['raw']['value'];                    $sourceSize = (strlen($source)>35) ? 'large' : 'regular';                    $budget = number_format($row->field_field_approved_budget[0]['raw']['value']);                    $amount = '';                    $ca = $row->field_field_contract_amount[0]['raw']['value'];                    if (is_numeric($ca)) {                        if (intval($ca)>0) {                            $amount = "<img src='/sites/all/themes/dgph/images/p-icon.png' alt=''>&nbsp;".number_format($ca);                        }                        else {                            $amount = '--';                        }                    }                    else {                         $amount = $ca;                    }                    $bcIcon = strtolower(str_replace(' ', '-', $bc));                    $pmIcon = philgeps_get_pm_icon_name($pm);                    $emptyClass = "";                    $noOfBiddersCode = "";                    $bidStatusTitle = "";                    $bidStatusReason = "";                    if ($status=='awarded') {                        $bidStatusTitle = "Awardee";                        $bidStatusReason = $row->field_field_awardee[0]['raw']['value'];                        $noOfBidders = $row->field_field_number_of_bidders[0]['raw']['value'];                        $noOfBiddersCode = "<span># OF BIDDERS</span><br><p>$noOfBidders</p><p class='small-footnote'>*See No. of Bidders Description</p>";                    }                    else {                        $emptyClass = "cell-12-empty";                        $bidStatusTitle = "Bid Status Reason";                        $bidStatusReason = $row->field_field_bid_status_reason[0]['raw']['value'];                    }                    $kmlLayerNames = philgeps_get_kml($nid);            ?>            <h3>                <div class='public-works-con-2 close-con'>                    <div class='cell-2'>                        <span><?php echo date('M', $dt) ?></span>                        <p><?php echo date('d', $dt) ?></p>                        <span><?php echo date('Y', $dt) ?></span>                    </div>                    <div class='cell-3'><span><?php echo $bidNo ?></span></div>                    <div class='cell-4 cell-4-<?php echo $sourceSize ?>'><?php echo $source ?></div>                    <div class='cell-5'><img src='/sites/all/modules/dgph_infographics/images/notices/<?php echo $bcIcon ?>.png' title='<?php echo $bc ?>' alt=''></div>                    <div class='cell-6'><img src='/sites/all/modules/dgph_infographics/images/notices/<?php echo $pmIcon ?>.png' title='<?php echo $pm ?>' alt=''></div>                    <div class='cell-7'><img src='/sites/all/themes/dgph/images/p-icon.png' alt=''>&nbsp;<?php echo $budget ?></div>                    <div class='cell-8'><?php echo $amount ?></div>                    <div class='cell-15 cell-15-<?php echo $status ?>'><?php echo $status ?><br><span><?php echo $dtBid ?></span></div>                    <div class='cell-9'><span class='h1'><?php echo $bidTitle ?></span></div>                    <div class='cell-16'>Details&nbsp;<img src='/sites/all/themes/dgph/images/show-details.png' alt=''></div>                </div>            </h3>            <div class='apnd-ui-accordion-content'>                <div class='clear'></div>                <div class='cell-13'>                    <h1><?php echo $bidStatusTitle ?></h1>                    <p><?php echo $bidStatusReason ?></p>                </div>                <div class='cell-12 <?php echo $emptyClass ?>'><?php echo $noOfBiddersCode ?></div>                <div class='clear'></div>                                                <div class="accordion4">                    <h3><img src='/sites/all/modules/dgph_infographics/images/procurement-bid-icon.png'> Procurement Bid Notice</h3>                    <div class="procurement-document-container">                        <?php                            $bidNotice = isset($row->field_field_procurement_bid_notice[0]) ? $row->field_field_procurement_bid_notice[0]['raw']['value'] : '';                            if (in_array('administrator', $roles) || in_array('agency', $roles)) {                        ?>                                <div class='pi-instructions'>                                    <textarea id="bid-notice-<?php echo $nid ?>" class="bid-notice" rows="5"><?php echo $bidNotice ?></textarea>                                    <a href="javascript:void(0)" class="bid-notice-update" onclick="philgeps_update_notice(<?php echo $nid ?>, 'bid')">Update</a>                                    <div class="philgeps-ajax-loading"></div>                                </div>                        <?php                            }                            else if (!empty($bidNotice)) {                                print "<div class='pi-instructions'>$bidNotice</div>";                            }                        ?>                        <div class="procurement-document"><a href="#" target='_blank' class='view-procurement-bid'>View Procurement Bid</a></div>                    </div>                    <h3><img src='".base_path()."/sites/all/modules/dgph_infographics/images/procurement-contract-icon.png'> Procurement Award Notice</h3>                    <div class="procurement-document-container">                        <?php                            $awardNotice = isset($row->field_field_award_notice_abstract[0]) ? $row->field_field_award_notice_abstract[0]['raw']['value'] : '';                            if (in_array('administrator', $roles) || in_array('agency', $roles)) {                        ?>                                <div class='pi-instructions'>                                    <textarea id="award-notice-<?php echo $nid ?>" class="award-notice" rows="5"><?php echo $awardNotice ?></textarea>                                    <a href="javascript:void(0)" class="award-notice-update" onclick="philgeps_update_notice(<?php echo $nid ?>, 'award')">Update</a>                                    <div class="philgeps-ajax-loading"></div>                                </div>                        <?php                            }                            else if (!empty($awardNotice)) {                                print "<div class='pi-instructions'>$awardNotice</div>";                            }                            $showAwardDocs = (($status!='closed') && ($status!='cancelled') && ($status!='failed') && ($status!='shortlisted'));                            $awardID = is_numeric($row->field_field_award_id[0]['raw']['value']) ? intval($row->field_field_award_id[0]['raw']['value']) : 0;                        ?>                        <?php if ($showAwardDocs && ($awardID>0)) { ?>                         <div class="procurement-document"><a href="#" target='_blank' class='view-procurement-bid'>View Award Notice Abstract</a></div>                        <?php } ?>                    </div>                    <h3><img src='".base_path()."/sites/all/modules/dgph_infographics/images/procurement-contract-icon.png'> Procurement Award Contract</h3>                    <div class="procurement-document-container">                        <div class='pi-instructions'>This contains the Award Contract and other related documents (Notice of Award, BAC Resolution, Notice of Proceed, Signed Contract, etc ...)</div>                        <div class="procurement-document">                    <?php                        if ($showAwardDocs) {                            $cinfo = isset($row->field_field_contract_info[0]) ? $row->field_field_contract_info[0]['raw']['value'] : '';                            $cdocs = philgeps_extract_award_contract($cinfo);                            if (!empty($cdocs)) {                    ?>                            <ul class='contract-docs'>                    <?php                                foreach($cdocs as $docType => $docs) {                    ?>                                <li><?php echo $docType ?>                                    <ul class='contract-type-docs'>                                    <?php                                         foreach($docs as $doc) {                                            $fileExists = $doc[PHILGEPS_CONTRACT_FILE_EXISTS];                                            $docName = $doc[PHILGEPS_CONTRACT_DOCUMENT_NAME];                                            if ($fileExists) {                                                $docUrl = $doc[PHILGEPS_CONTRACT_DOCUMENT_URL];                                    ?>                                        <li><a href='<?php echo $docUrl ?>' target='_blank'><?php echo $docName ?></a></li>                                    <?php                                            }                                            else {                                    ?>                                        <li><?php echo $docName ?> (document not available)</li>                                    <?php                                            }                                        }                                    ?>                                    </ul>                                </li>                    <?php                                 }                    ?>                            </ul>                    <?php                            }                             else {                     ?>                            <p class='not-avail'>No document available at the moment.</p>                    <?php                               }                         }                    ?>                        </div>                    </div>                    <!--                    <?php foreach($kmlLayerNames as $idx => $kmlLayerName) { ?>                    <input type="hidden" id="kml-layer-filename-<?php echo $nid.'-'.$idx ?>" value="<?php echo $kmlLayerName ?>">                    <?php } ?>                    -->                    <h3 onclick="resize_map_<?php echo $nid ?>()" id="view-map-<?php echo $nid ?>"><img src='/sites/all/modules/dgph_infographics/images/viewmap-icon.png'> View Map</h3>                    <div id="map-container-<?php echo $nid ?>" class="procurement-map-container">                        <div id="map-container-inner-<?php echo $nid ?>" class="map_canvas" style="height:500px;"></div>                    </div>                    <script type="text/javascript">                        docReady(function(){                            window.map_<?php echo $nid ?>;                            function initialize() {                              // create the map                                var myOptions = {                                    zoom: 5,                                    center: new google.maps.LatLng(12.683152, 122.730924),                                    streetViewControl: false,                                    mapTypeId: google.maps.MapTypeId.HYBRID                                  }                                window.map_<?php echo $nid ?> = new google.maps.Map(document.getElementById("map-container-inner-<?php echo $nid ?>"), myOptions);                                get_and_load_kml_files();                            }                            initialize();                            function get_and_load_kml_files(){                                jQuery.getJSON('http://open-data-network.appspot.com/api/v1/data?type=FEEDBACK&dgph_node_id=<?php echo $nid ?>&callback=?', function(data){                                    console.log('http://open-data-network.appspot.com/api/v1/data?type=FEEDBACK&dgph_node_id=<?php echo $nid ?>&callback=?');                                    console.log('in....');                                    if(data){                                        console.log(data);                                        console.log('yey in');                                        data = data.data;                                        for(var i=0; i<data.length; i++){                                            console.log('super in');                                            console.log([i]);                                            if(data[i].file){                                                console.log('super super in');                                                try{                                                    console.log(data[i].file.file_url);                                                    add_kml_to_map('<?php echo $nid ?>', data[i].file.file_url);                                                }                                                catch(e){                                                    console.log(e);                                                }                                            }                                        }                                    }                                });                            }                        });                        function resize_map_<?php echo $nid ?>(){                            setTimeout(function(){google.maps.event.trigger(window.map_<?php echo $nid ?>, 'resize'); window.map_<?php echo $nid ?>.setCenter(new google.maps.LatLng(12.683152, 122.730924)); window.map_<?php echo $nid ?>.setZoom(5);}, 1000);                        }                    </script>                    <h3><img src='/sites/all/modules/dgph_infographics/images/view-feedback-icon.png'> View Feedback</h3>                    <div class="procurement-feedback-container">                        <iframe src="http://open-data-network.appspot.com/iframes/v1/comments?dgph_node_id=<?php echo $nid ?>&philgeps_bid_reference_number=<?php echo $bidNo ?>&philgeps_org_id=<?php echo $orgID ?>&philgeps_project_name=<?php echo rawurlencode($projectName) ?>" style="border: none; background: none; width: 100%; min-height: 550px;"></iframe>                    </div>                </div>            </div>            <?php } ?>        </div>        <!-- <div id="map-placeholder-container"><div id="map-placeholder"><?php echo $mapCode ?></div></div> -->        <?php print $view->query->render_pager() ?>        <div class='clear'></div>        <div class='large-12 columns legend'>            <h1 class='notices'>Legend</h1>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Bid #</div></div>                <div class='large-9 columns'><div class='field-value'>System-generated number</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Date Posted</div></div>                <div class='large-9 columns'><div class='field-value'>Date of publication</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Bid Classification</div></div>                <div class='large-9 columns'><div class='field-value'>General classification of goods, works & consulting services</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Procurement Mode</div></div>                <div class='large-9 columns'>                    <div class='field-value'>                        <p>Chosen method of procurement<br>**Alternative Methods of Procurement - the procuring entity may use these methods only in highly exceptional cases as provided:</p>                        <ol class='alpha'>                            <li><b>Limited Source Bidding</b> otherwise known as selective bidding, involves direct invitation to bid by procuring entity from the list of pre-selected suppliers or consultants with known experience and proven capability</li>                            <li><b>Direct Contracting</b> or single source procurement, may be used in the procurement of goods which can be obtained only from proprietary source, exclusive dealer or manufacturers</li>                            <li><b>Repeat Order</b> may be used in the procurement of goods from the winning bidder but shall not exceed 25% of the quantity of each item in the original contract</li>                            <li><b>Shopping</b> is used when a procuring entity simply requests for submission of price quotations for readily available off-the-shelf goods or regular equipment</li>                            <li><b>Negotiated Procurement</b> is used when procuring entity directly negotiates a contract with a technically, legally, and financially capable supplier. Below is a list of the types of negotiated procurement as provided:                                <ol class='roman'>                                    <li>Two Failed Biddings </li>                                    <li>Emergency Cases </li>                                    <li>Take-Over of Contracts </li>                                    <li>Adjacent or Contiguous </li>                                    <li>Agency-to-Agency</li>                                    <li>Procurement Agent </li>                                    <li>Highly Technical Consultants </li>                                </ol>                            </li>                        </ol>                    </div>                </div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Bid Title</div></div>                <div class='large-9 columns'><div class='field-value'>Title of bid opportunity</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Approved Budget</div></div>                <div class='large-9 columns'><div class='field-value'>Budget for the contract as approved by the head of the procuring entity; or the Estimated Contract Cost in the case of Foreign-funded Procurement</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Bid Status</div></div>                <div class='large-9 columns'>                    <div class='field-value'>                        <ul>                            <li><b>Awarded</b> - The Notice of Award is posted</li>                            <li><b>Cancelled</b> - When there is incorrect/insufficient information provided in the Bid Notice</li>                            <li><b>Closed</b> - The Bid Notice has reached the Deadline of bid submission and the bid result is not yet posted</li>                            <li><b>Failed</b> - The Bidding is declared as failed</li>                            <li><b>Shortlisted</b> - The shortlisted consultants and the 2nd stage notice are posted. Also indicated is the date of current bid status.</li>                        </ul>                        <p class="bid-status">Some Bid Notices with <b>*Closed*</b> status that are displayed as <b>*Awarded*</b> in the dashboard, reflects projects with at least one Awarded line item.</p>                    </div>                </div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>No. of Bidders</div></div>                <div class='large-9 columns'>                    <div class='field-value'>                        Refers to the number of bidders who submitted bids. If no. of bidders is 1, the following conditions are to be considered:                        <ol class='alpha'>                            <li>There is a Single Calculated/Rated and Responsive Bid where only one bidder submitted a bid as specified</li>                            <li>The procurement mode used is Alternative Methods of Procurement under Rule.</li>                            <li>Only the winning bidder was posted</li>                        </ol>                    </div>                </div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Awardee</div></div>                <div class='large-9 columns'><div class='field-value'>Name of the bidder that was awarded the contract</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Contract Amount</div></div>                <div class='large-9 columns'><div class='field-value'>Amount of the contract as approved by the head of the procuring entity</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>Funding Source</div></div>                <div class='large-9 columns'><div class='field-value'>Source of the funds</div></div>            </div>            <div class='row'>                <div class='large-3 columns'><div class='field-name'>" - Main"</div></div>                <div class='large-9 columns'><div class='field-value'>Indicates the head agency. (Example: Department of one)</div></div>            </div>        </div>        <!-- <p class="mb50" style="font-size: 13px;">Note: <em>" - Main" indicates the head agency. (Example: Department of Agriculture - Main)</em></p> -->    </div></div><?php    $activeIndex = "";    if ($curBc!='all') {        $activeIndex = "0";    }    else if ($curAb!='all') {        $activeIndex = "1";    }    else if ($curPm!='all') {        $activeIndex = "2";    }    else if ($curSt!='all') {        $activeIndex = "3";    }    else if ($curMid!='all') {        $activeIndex = "4";    }?><input type='hidden' id='default-active' value='<?php echo $activeIndex ?>'><script type='text/javascript' src='//static.addtoany.com/menu/page.js'></script><script type="text/javascript">function add_kml_to_map(node_id, file_url){    var ctaLayer = new google.maps.KmlLayer(file_url, {        map: window['map_' + node_id]    });}var total_count_of_records = 0;function get_awards(){    jQuery.getJSON('#', function(data){        if(data.result.records[0].count){            total_count_of_records += parseInt(data.result.records[0].count);        }    });}function get_bidders_list(){    jQuery.getJSON('http://api.data.gov.ph/catalogue/api/action/datastore_search_sql?sql=SELECT%20count(*)%20from%20"922f8c2c-8ef6-4e46-bc4e-8799c47b8ecf"&callback=?', function(data){        if(data.result.records[0].count){            total_count_of_records += parseInt(data.result.records[0].count);        }        show_total();    });}function get_organizations(){    jQuery.getJSON('http://api.data.gov.ph/catalogue/api/action/datastore_search_sql?sql=SELECT%20count(*)%20from%20"23de10e9-197e-4294-abd1-eba0188110cd"&callback=?', function(data){        if(data.result.records[0].count){            total_count_of_records += parseInt(data.result.records[0].count);        }        show_total();    });}function get_bid_line_items(){    jQuery.getJSON('http://api.data.gov.ph/catalogue/api/action/datastore_search_sql?sql=SELECT%20count(*)%20from%20"63e29a04-6b13-48f8-ab13-ba72dc9ffcdc"&callback=?', function(data){        if(data.result.records[0].count){            total_count_of_records += parseInt(data.result.records[0].count);        }        show_total();    });}function get_bid_information(){    jQuery.getJSON('http://api.data.gov.ph/catalogue/api/action/datastore_search_sql?sql=SELECT%20count(*)%20from%20"9c74991c-a5e6-4489-8413-c20a8a181d90"&callback=?', function(data){        if(data.result.records[0].count){            total_count_of_records += parseInt(data.result.records[0].count);        }        show_total();    });}function get_project_location(){    jQuery.getJSON('http://api.data.gov.ph/catalogue/api/action/datastore_search_sql?sql=SELECT%20count(*)%20from%20%221da548c2-d141-4d9a-b159-8d36606d2ae2%22&callback=?', function(data){        if(data.result.records[0].count){            total_count_of_records += parseInt(data.result.records[0].count);        }        show_total();    });}function get_organization_business_categories(){    jQuery.getJSON('http://api.data.gov.ph/catalogue/api/action/datastore_search_sql?sql=SELECT%20count(*)%20from%20"b0efc90c-88ab-469a-a694-e598dd47f724"&callback=?', function(data){        if(data.result.records[0].count){            total_count_of_records += parseInt(data.result.records[0].count);        }        show_total();    });}function addCommas(nStr){    nStr += '';    var x = nStr.split('.');    var x1 = x[0];    var x2 = x.length > 1 ? '.' + x[1] : '';    var rgx = /(\d+)(\d{3})/;    while (rgx.test(x1)) {        x1 = x1.replace(rgx, '$1' + ',' + '$2');    }    return x1 + x2;}function show_total(){    jQuery("#total_data_rows").text(addCommas(total_count_of_records));}docReady(function(){    get_awards();    get_bidders_list();    get_organizations();    get_bid_line_items();    get_bid_information();    get_project_location();    get_organization_business_categories();});</script>